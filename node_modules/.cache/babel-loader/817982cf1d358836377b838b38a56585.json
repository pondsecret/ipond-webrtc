{"ast":null,"code":"import \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.replace.js\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport ImageGallery from '@/components/ImageGallery.vue';\nimport UserProfile from '@/components/UserProfile.vue';\nimport { Janus } from 'janus-gateway'; // webRTC server location\n\nvar JANUS_URL = 'https://34.143.225.243:8089/janus';\n\nif (window.location.protocol === 'http:') {\n  JANUS_URL = 'http://34.143.225.243:8088/janus';\n}\n\nexport default {\n  name: \"StreamingVideo\",\n  data: function data() {\n    return {\n      janus: null,\n      snackbar: false,\n      recording: false,\n      False: false,\n      openProfile: false,\n      openGallery: false,\n      mini: true,\n      colors: {\n        background: \"#fff\",\n        text: \"#2F75BB\",\n        vid_bg: \"#322d31\"\n      },\n      menus: [{\n        title: \"Drone01\",\n        icon: \"mdi-quadcopter\"\n      }, {\n        title: \"Drone02\",\n        icon: \"mdi-quadcopter\"\n      }, {\n        title: \"Drone03\",\n        icon: \"mdi-quadcopter\"\n      }],\n      users: {\n        name: \"Some Mans\",\n        email: \"example@email.com\",\n        src: \"https://randomuser.me/api/portraits/men/85.jpg\"\n      },\n      attach: {\n        plugin: null,\n        message: {\n          status: null\n        }\n      },\n      janusError: null\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    Janus.init({\n      debug: true,\n      dependencies: Janus.useDefaultDependencies(),\n      callback: function callback() {\n        // console.log(\"Connecting to Janus api with server \",JANUS_URL)\n        _this.connect(JANUS_URL);\n      }\n    });\n  },\n  methods: {\n    showGallery: function showGallery() {\n      this.openGallery = true;\n      console.log(this.openGallery);\n      return this.openGallery;\n    },\n    setOpenGallery: function setOpenGallery(value) {\n      this.openGallery = value;\n    },\n    showProfile: function showProfile() {\n      this.openProfile = true;\n      return this.openProfile;\n    },\n    setOpenProfile: function setOpenProfile(value) {\n      this.openProfile = value;\n    },\n    toggleRecord: function toggleRecord() {\n      this.recording = !this.recording;\n      this.snackbar = true;\n      var streamer = document.getElementById('player');\n\n      if (this.recording === true) {\n        this.startRecord(streamer.captureStream());\n      } else {\n        this.stopRecord(streamer);\n      }\n    },\n    startRecord: function startRecord(stream) {\n      var recorder = stream.captureStream();\n      console.log('Record.....', recorder);\n    },\n    stopRecord: function stopRecord(stream) {\n      console.log('Stop Record.....', stream);\n    },\n    // Janus Implement\n    // Connect to Janus\n    connect: function connect(server) {\n      var _this2 = this;\n\n      this.janus = new Janus({\n        server: server,\n        // Call on success callback\n        success: function success() {\n          console.log(\"Connected\");\n        },\n        // Call on error callback\n        error: function error(err) {\n          console.log(\"Error establish connection to Janus server! Please check the server status.\");\n\n          _this2.onError(\"Failed to connect Janus server \", err);\n        },\n        destroyed: function destroyed() {\n          console.log(\"Destroyed\");\n        }\n      });\n    },\n    // Attach Plugin\n    attachPlugin: function attachPlugin() {\n      var _this3 = this;\n\n      this.janus.attach({\n        plugin: \"janus.plugin.streaming\",\n        opaqueId: 'thisisopaqueid',\n        // on Attach plugin success\n        success: function success(pluginHandle) {\n          _this3.attach.plugin = pluginHandle;\n          console.log(\"Attact Plugin Success with track bit rate : \", _this3.attach.plugin.getBitrate());\n        },\n        // on Attach plugin error\n        error: function error(err) {\n          _this3.onError(\"Error attaching plugin...! \", err);\n        },\n        iceState: function iceState(state) {\n          console.log(\"ICE state changed to \", state);\n        },\n        webrtcState: function webrtcState(on) {\n          console.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\");\n        },\n        slowLink: function slowLink(uplink, lost, mid) {\n          console.log(\"Janus reports problems \" + (uplink ? \"sending\" : \"receiving\") + \" packets on mid \" + mid + \" (\" + lost + \" lost packets)\");\n        },\n        onmessage: function onmessage(msg, jsep) {\n          // Get message \n          var result = msg.result;\n\n          if (result) {\n            if (result.status) {\n              _this3.attach.message.status = result.status;\n            }\n          } // Handle error message\n          else if (msg.error) {\n            _this3.onError(msg.error);\n\n            return;\n          } // Handle jsep\n\n\n          if (jsep) {\n            Janus.debug(\"Handling SDP as Well.... \", jsep);\n            var stereo = jsep.sdp.indexOf(\"stereo=1\") !== -1;\n\n            _this3.attach.plugin.createAnswer({\n              jsep: jsep,\n              media: {\n                audioSend: false,\n                videoSend: false,\n                data: true\n              },\n              customizeSdp: function customizeSdp(jsep) {\n                if (stereo && jsep.sdp.indexOf(\"stereo=1\") == -1) {\n                  jsep.sdp = jsep.sdp.replace(\"useinbandfec=1\", \"useinbandfec=1;stereo=1\");\n                }\n              },\n              success: function success(jsep) {\n                Janus.debug(\"Got SDP!\", jsep);\n                var body = {\n                  request: \"start\"\n                };\n\n                _this3.plugin.send({\n                  message: body,\n                  jsep: jsep\n                });\n              }\n            });\n          }\n        }\n      });\n    },\n    // Handle Janus Errors\n    onError: function onError(msg) {\n      var err = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      Janus.error(msg, err);\n      this.janusError = msg + err;\n      alert(this.janusError, function () {\n        window.location.reload();\n      });\n    }\n  },\n  components: {\n    ImageGallery: ImageGallery,\n    UserProfile: UserProfile\n  }\n};","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8IA;AACA;AACA,sC,CAEA;;AACA;;AACA;AACAA;AACA;;AAEA;AACAC,wBADA;AAEAC;AACA;AACAC,iBADA;AAEAC,qBAFA;AAGAC,sBAHA;AAIAC,kBAJA;AAKAC,wBALA;AAMAC,wBANA;AAOAC,gBAPA;AAQAC;AACAC,0BADA;AAEAC,uBAFA;AAGAC;AAHA,OARA;AAaAC,cACA;AAAAC;AAAAC;AAAA,OADA,EAEA;AAAAD;AAAAC;AAAA,OAFA,EAGA;AAAAD;AAAAC;AAAA,OAHA,CAbA;AAkBAC;AACAhB,yBADA;AAEAiB,kCAFA;AAGAC;AAHA,OAlBA;AAuBAC;AACAC,oBADA;AAEAC;AACAC;AADA;AAFA,OAvBA;AA6BAC;AA7BA;AA+BA,GAlCA;AAmCAC,SAnCA,qBAmCA;AAAA;;AACAC;AACAC,iBADA;AAEAC,kDAFA;AAGAC;AACA;AACA;AACA;AANA;AAQA,GA5CA;AA6CAC;AAEAC,eAFA,yBAEA;AACA;AACAC;AACA;AACA,KANA;AAOAC,kBAPA,0BAOAC,KAPA,EAOA;AACA;AACA,KATA;AAUAC,eAVA,yBAUA;AACA;AACA;AACA,KAbA;AAcAC,kBAdA,0BAcAF,KAdA,EAcA;AACA;AACA,KAhBA;AAiBAG,gBAjBA,0BAiBA;AACA;AACA;AACA;;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KA1BA;AA2BAC,eA3BA,uBA2BAC,MA3BA,EA2BA;AACA;AAEAP;AACA,KA/BA;AAgCAQ,cAhCA,sBAgCAD,MAhCA,EAgCA;AACAP;AACA,KAlCA;AAoCA;AACA;AACAS,WAtCA,mBAsCAC,MAtCA,EAsCA;AAAA;;AACA;AAAAA;AACA;AACAC;AACAX;AACA,SAJA;AAKA;AACAY;AACAZ;;AACA;AACA,SATA;AAUAa;AACAb;AACA;AAZA;AAcA,KArDA;AAuDA;AACAc,gBAxDA,0BAwDA;AAAA;;AACA;AACAzB,wCADA;AAEA0B,kCAFA;AAGA;AACAJ;AACA;AACAX;AACA,SAPA;AAQA;AACAY;AACA;AACA,SAXA;AAYAI;AACAhB;AACA,SAdA;AAeAiB;AACAjB;AACA,SAjBA;AAkBAkB;AACAlB,uFACA,kBADA,GACAmB,GADA,GACA,IADA,GACAC,IADA,GACA,gBADA;AAEA,SArBA;AAsBAC;AACA;AACA;;AACA;AACA;AACA;AACA;AACA,WAJA,CAKA;AALA,eAMA;AACA;;AACA;AACA,WAZA,CAcA;;;AACA;AACA3B;AACA;;AACA;AACA4B,wBADA;AAEAC;AACAC,gCADA;AAEAC,gCAFA;AAGAvD;AAHA,eAFA;AAOAwD;AACA;AACAJ;AACA;AACA,eAXA;AAYAX;AACAjB;AACA;AAAAiC;AAAA;;AACA;AACArC,+BADA;AAEAgC;AAFA;AAIA;AAnBA;AAqBA;AACA;AA9DA;AAgEA,KAzHA;AA2HA;AACAM,WA5HA,mBA4HAC,GA5HA,EA4HA;AAAA;AACAnC;AACA;AACAoC;AACAC;AACA,OAFA;AAGA;AAlIA,GA7CA;AAkLAC;AAAAC;AAAAC;AAAA;AAlLA","names":["JANUS_URL","name","data","janus","snackbar","recording","False","openProfile","openGallery","mini","colors","background","text","vid_bg","menus","title","icon","users","email","src","attach","plugin","message","status","janusError","mounted","Janus","debug","dependencies","callback","methods","showGallery","console","setOpenGallery","value","showProfile","setOpenProfile","toggleRecord","startRecord","stream","stopRecord","connect","server","success","error","destroyed","attachPlugin","opaqueId","iceState","webrtcState","slowLink","mid","lost","onmessage","jsep","media","audioSend","videoSend","customizeSdp","request","onError","msg","alert","window","components","ImageGallery","UserProfile"],"sourceRoot":"src/views/Main","sources":["StreamingVideo.vue"],"sourcesContent":["<template>\n  <v-container fill-height fluid class=\"pa-0 ma-0 \" ref=\"main\" width=\"100%\">\n    <v-card width=\"100%\" height=\"100%\" class=\"d-flex\" :color=\"colors.vid_bg\">\n        <!-- main menu drawer -->\n      <v-navigation-drawer\n      :color=\"colors.background\"\n      :mini-variant.sync=\"mini\"\n      mini-variant-width=\"56\"\n      clipped\n      app\n      ref=\"navDrawer\"\n      width=\"300\"\n      permanent\n      >\n\n        <!-- List menus -->\n        <v-list-item class=\"px-2 my-4\">\n          <v-list-item-avatar>\n            <v-img :src=\"users.src\" ></v-img>\n          </v-list-item-avatar>\n\n          <v-list-item-title>\n            <h3 style=\"color:#2F75BB\">{{users.name}}</h3>\n            <h5 class=\"pt-2\">{{users.email}}</h5>\n          </v-list-item-title>\n\n          <v-btn\n          icon\n          @click.stop=\"mini = !mini\"\n          >\n          <v-icon :color=\"colors.text\">mdi-chevron-left</v-icon>\n          </v-btn>\n        </v-list-item>\n        \n        <v-divider :color=\"colors.text\" class=\"my-4\"></v-divider>\n\n        <v-list  two-line dense nav>\n          <v-list-item-group\n          >\n            <v-list-item\n            :color=\"colors.text\"\n            v-for=\"menu in menus\"\n            :key=\"menu.title\">\n              <v-list-item-icon class=\"my-6\" >\n                <v-icon >{{menu.icon}}</v-icon>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title><h3>{{menu.title}}</h3></v-list-item-title>\n              </v-list-item-content>\n            </v-list-item>\n            \n            <!-- Gallery -->\n            <v-list-item\n            @click.prevent=\"showGallery\">\n              <v-list-item-icon class=\"my-6\">\n                <v-icon>mdi-image-multiple</v-icon>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title><h3>Gallery</h3></v-list-item-title>\n              </v-list-item-content>\n\n              <!-- Gallery component -->\n              <ImageGallery \n              :showDialog=\"openGallery\"\n              @closeGallery=\"setOpenGallery\"\n              />\n            </v-list-item>\n\n            <!-- User Profile -->\n            <v-list-item\n            @click.prevent=\"showProfile\">\n              <v-list-item-icon class=\"my-6\">\n                <v-icon>mdi-account</v-icon>\n              </v-list-item-icon>\n              <v-list-item-content>\n                <v-list-item-title><h3>My Account</h3></v-list-item-title>\n              </v-list-item-content>\n\n              <!-- User Profile component -->\n              <UserProfile \n              :showProfile=\"openProfile\"\n              :username=\"users.name\"\n              :useremail=\"users.email\"\n              :userimgsrc=\"users.src\"\n              @closeUserProfile=\"setOpenProfile\"\n              />\n            </v-list-item>\n          </v-list-item-group>\n        </v-list>\n\n        <!-- List menus -->\n      </v-navigation-drawer>\n      <!-- main menu drawer -->\n\n      <!-- Video field -->\n      <v-card width=\"100%\" height=\"100%\" tile class=\"d-flex justify-center \" :color=\"colors.vid_bg\">\n        <video id=\"player\"  controls src=\"https://wiki.yoctoproject.org/wiki/images/a/a6/Big-buck-bunny_trailer.webm\"  autoplay loop ></video>\n\n        <!-- Video Overlat record button -->\n        <v-overlay\n        absolute\n        opacity=\"0\"\n        style=\"height:25px ; width:60px; left:94%; top:88%\"\n        :dark=\"False\">\n          <v-tooltip top >\n            <template v-slot:activator=\"{on}\">\n              <v-btn\n              rounded  \n              v-on=\"on\"\n              style=\"opacity:0.9\"\n              @click=\"toggleRecord\">\n              <v-snackbar\n              v-model=\"snackbar\"\n              app\n              timeout=\"2000\"\n              top\n              light\n              color=\"success\"\n              content-class=\"d-flex justify-center\"\n              >\n                {{!recording ? 'Stop Recording Stream!' : 'Recording Stream'}}\n              </v-snackbar>\n                <span class=\"text-h5\">{{recording ? ' 00:00 ' : null}}</span>\n                <v-icon v-if=\"recording === false\" color=\"error\">mdi-radiobox-marked</v-icon>\n                <v-icon v-else color=\"error\" class=\"ml-4\">mdi-stop</v-icon>\n              </v-btn>\n            </template>\n            <span v-if=\"recording === false\">Start Record Video</span>\n            <span  v-else >Stop Recording</span>\n          </v-tooltip>\n\n        </v-overlay>\n\n      </v-card>\n      <!-- Video field -->\n      \n    </v-card>\n\n  </v-container>\n</template>\n\n<script>\nimport ImageGallery from '@/components/ImageGallery.vue'\nimport UserProfile from '@/components/UserProfile.vue';\nimport { Janus } from 'janus-gateway'\n\n// webRTC server location\nlet JANUS_URL = 'https://34.143.225.243:8089/janus'\nif(window.location.protocol === 'http:'){\n   JANUS_URL = 'http://34.143.225.243:8088/janus'\n}\n\nexport default {\n    name: \"StreamingVideo\",\n    data: () => {\n        return {\n            janus: null,\n            snackbar: false,\n            recording: false,\n            False : false,\n            openProfile: false,\n            openGallery: false,\n            mini: true,\n            colors: {\n                background: \"#fff\",\n                text: \"#2F75BB\",\n                vid_bg: \"#322d31\"\n            },\n            menus: [\n                { title: \"Drone01\", icon: \"mdi-quadcopter\" },\n                { title: \"Drone02\", icon: \"mdi-quadcopter\" },\n                { title: \"Drone03\", icon: \"mdi-quadcopter\" },\n            ],\n            users:{\n              name: \"Some Mans\",\n              email: \"example@email.com\",\n              src:  \"https://randomuser.me/api/portraits/men/85.jpg\"\n            },\n            attach:{\n              plugin: null,\n              message: {\n                status: null\n              }\n            },\n            janusError: null\n        };\n    },\n    mounted() {\n      Janus.init({\n        debug: true,\n        dependencies: Janus.useDefaultDependencies(),\n        callback: ()=>{\n          // console.log(\"Connecting to Janus api with server \",JANUS_URL)\n          this.connect(JANUS_URL)\n        }\n      })\n    },\n    methods: {\n        \n        showGallery() {\n            this.openGallery = true;\n            console.log(this.openGallery)\n            return this.openGallery;\n        },\n        setOpenGallery(value){\n          this.openGallery = value\n        },\n        showProfile(){\n          this.openProfile = true;\n          return this.openProfile\n        },\n        setOpenProfile(value){\n          this.openProfile = value\n        },\n        toggleRecord(){\n          this.recording = !this.recording\n          this.snackbar = true\n          let streamer = document.getElementById('player')\n          if(this.recording  === true){\n            this.startRecord(streamer.captureStream())\n          }else{\n            this.stopRecord(streamer)\n          }\n        },\n        startRecord(stream){\n          let recorder = stream.captureStream()\n\n          console.log('Record.....' , recorder)\n        },\n        stopRecord(stream){\n          console.log('Stop Record.....', stream)\n        },\n\n        // Janus Implement\n        // Connect to Janus\n        connect(server){\n          this.janus = new Janus({server,\n            // Call on success callback\n            success: ()=>{\n              console.log(\"Connected\")\n            },\n            // Call on error callback\n            error: (err)=>{\n              console.log(\"Error establish connection to Janus server! Please check the server status.\")\n              this.onError(\"Failed to connect Janus server \",err)\n            },\n            destroyed: ()=>{\n              console.log(\"Destroyed\")\n            }\n          })\n        },\n\n        // Attach Plugin\n        attachPlugin() {\n          this.janus.attach({\n            plugin:   \"janus.plugin.streaming\",\n            opaqueId: 'thisisopaqueid',\n            // on Attach plugin success\n            success: (pluginHandle) => {\n              this.attach.plugin = pluginHandle\n              console.log(\"Attact Plugin Success with track bit rate : \",this.attach.plugin.getBitrate())\n            },\n            // on Attach plugin error\n            error: (err) => {\n              this.onError(\"Error attaching plugin...! \",err)\n            },\n            iceState: (state) => {\n              console.log(\"ICE state changed to \",state)\n            },\n            webrtcState: (on) => {\n              console.log(\"Janus says our WebRTC PeerConnection is \" + (on ? \"up\" : \"down\") + \" now\")\n            },\n            slowLink: (uplink, lost, mid) => {\n              console.log(\"Janus reports problems \" + (uplink ? \"sending\" : \"receiving\") +\n                        \" packets on mid \" + mid + \" (\" + lost + \" lost packets)\")\n            },\n            onmessage: (msg, jsep) => {\n              // Get message \n              let result = msg.result\n              if(result){\n                if(result.status){\n                  this.attach.message.status = result.status\n                }\n              }\n              // Handle error message\n              else if(msg.error){\n                this.onError(msg.error)\n                return;\n              }\n\n              // Handle jsep\n              if(jsep){\n                Janus.debug(\"Handling SDP as Well.... \",jsep)\n                let stereo = (jsep.sdp.indexOf(\"stereo=1\") !== -1 )\n                this.attach.plugin.createAnswer({\n                  jsep: jsep,\n                  media: {\n                    audioSend: false,\n                    videoSend: false,\n                    data:      true,\n                  },\n                  customizeSdp: (jsep) => {\n                    if(stereo && jsep.sdp.indexOf(\"stereo=1\") == -1 ) {\n                      jsep.sdp = jsep.sdp.replace(\"useinbandfec=1\", \"useinbandfec=1;stereo=1\")\n                    }\n                  },\n                  success: (jsep) => {\n                    Janus.debug(\"Got SDP!\", jsep)\n                    let body = { request: \"start\"}\n                    this.plugin.send({\n                      message: body,\n                      jsep: jsep\n                    })\n                  },\n                })\n              }\n            }\n          })\n        },\n\n        // Handle Janus Errors\n        onError(msg, err='') {\n          Janus.error(msg, err)\n          this.janusError = msg + err\n          alert(this.janusError, function(){\n            window.location.reload()\n          })\n        }\n    },\n    \n    components: { ImageGallery, UserProfile }\n}\n</script>\n\n<style>\n:-webkit-scrollbar{\n    width:2px;\n}\n::-webkit-scrollbar-track {\n\t\n  background: #f1f1f1; \n}\n \n/* Handle */\n::-webkit-scrollbar-thumb {\n  background: #888; \n}\n\n/* Handle on hover */\n::-webkit-scrollbar-thumb:hover {\n  background: #555; \n}\n</style>"]},"metadata":{},"sourceType":"module"}